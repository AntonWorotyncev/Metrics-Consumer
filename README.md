# Metrics-Consumer
Микросервис "Metrics Сonsumer", будет прослушивать в Kafka топик "metrics-topic". Для успешного запуска сервиса необходимо необходимо:

Обратиться к файлу docker-compose.yml и выполнить команду: `docker-compose.yml up` Таким образом запустим контейнер с `БД PostgresQL` для хранения метрик, переданных другим сервисом. Перед запуском приложения необходимо убедиться, что сервис стартовал - конфигурация не конфликтует и не вызывает проблем.

Далее необходимо выполнить запуск приложения Metrics Consumer, при необходимоости можно сменить порт веб - сервера на альтернативный: дополнив файл настроек application.yml следующей командой: `server.port: yourPort`

При старте приложения, осуществляется автоматическое прослушивание топика и подключение к БД. К слушателю  партиями - прилетают JSON - сообщения, которые в последствии сохраняются в БД , и из Swagger API мы можем далее получить эти сообщения в двух режимах: весь список метрик или конкретно по ID: 

`/api/metrics-consumer/metrics
/api/metrics-consumer/metrics/{id}`

**Особенности архитектуры решения:**

Конфигурация `Kafka` в данном случае ориентирована на пакетную обработку сообщений, поэтому согласно действующим настройкам:

В данной конфигурации слушатель Kafka будет работать следующим образом:

**Группа потребителей:** Слушатель принадлежит к группе потребителей metrics-consumer-group, что позволяет распределить нагрузку по обработке сообщений между несколькими инстанциями слушателей.

**Автосброс смещения:** Если смещение для данного потребителя не найдено, он начнет чтение с самого старого сообщения в топике (auto-offset-reset: earliest).

**Десериализация:** Ключи сообщений будут десериализоваться как строки, а значения как JSON-объекты, используя указанные десериализаторы.

**Подтверждение** обработки: Автоматическое подтверждение обработки сообщений отключено (enable.auto.commit: false), поэтому слушатель будет подтверждать сообщения вручную (ack-mode: manual).

**Пакетная обработка**: Слушатель настроен на пакетный режим (type: batch), что означает, что он будет получать и обрабатывать сообщения пакетами.

**Минимальный размер данных для получения**: Слушатель будет ждать получения не менее 1 МБ данных за один раз (fetch-min-size: 1048576).

**Максимальное количество записей:** За один вызов метода poll() будет получено не более 10 записей (max-poll-records: 10).

**Максимальное время ожидания:** Слушатель будет ждать до 10 секунд, чтобы получить минимальный размер данных (fetch-max-wait: 10000).

**Уровень изоляции:** Будут читаться только подтвержденные транзакции (isolation.level: read_committed).

**Доверенные пакеты для десериализации:** Все пакеты являются доверенными для десериализации JSON объектов (spring.json.trusted.packages: '*').

**Метрики:** Включен сбор и отправка метрик по топику metrics-topic, с использованием группы потребителей metricsGroup и префиксом идентификатора клиента t1.

Таким образом, слушатель будет обрабатывать сообщения в пакетном режиме, подтверждая их вручную, и собирать метрики для анализа производительности и других характеристик работы.
